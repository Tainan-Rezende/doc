---
sidebar_label: 'Consult Deposit'
sidebar_position: 1
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import useBaseUrl from '@docusaurus/useBaseUrl';

# Consult Deposit

This endpoint allows for a detailed query of a previously created deposit request. Although it is widely used to check the "deposit status", it returns the complete object with all the vital transaction information.

---

## Endpoint
- **Method:** <span className="badge badge--success">GET</span>

```bash title="Endpoint URL"
https://api.xgateglobal.com/deposit/TRANSACTION_ID/details
```

:::warning[Important]
The **TRANSACTION_ID** value in the URL refers to the deposit's `_id` generated by XGate when creating the request.
:::

---

## Request

### Required Headers

| Header          | Value                 | Description                                 |
| :-------------- | :-------------------- | :------------------------------------------ |
| `Authorization` | `Bearer <your_token>` | JWT authentication token obtained at login. |

---

## Responses

### Success (200 OK)

The transaction was found. The returned data structure varies according to the operation type (Fiat or Crypto).

**1. Pix Deposit (Fiat BRL):**

```json
{
    "_id": "6996202*******************",
    "currency": {
        "name": "BRL",
        "type": "PIX",
        "amount": 0.2,
        "status": "PAID"
    },
    "document": "487********",
    "externalId": "webhook-test-a30c0229",
    "identifiedDocumentPix": true,
    "customerId": "697e15d*******************"
}
```

**2. Pix Deposit converting to USDT:**

```json
{
    "_id": "6971c5d*******************",
    "currency": {
        "name": "BRL",
        "type": "PIX",
        "amount": 0.2,
        "status": "PAID"
    },
    "cryptocurrency": {
        "name": "USDT",
        "symbol": "USDT",
        "amount": 0.037297,
        "status": "PAID",
        "coinGecko": "tether",
        "blockchainNetwork": {
            "name": "Ethereum",
            "chainId": "1"
        }
    },
    "document": "487********",
    "identifiedDocumentPix": true,
    "customerId": "68e7b8f*******************"
}
```

**3. USDT Deposit:**

```json
{
    "_id": "696fbfd*******************",
    "cryptocurrency": {
        "name": "USDT",
        "symbol": "USDT",
        "amount": 15.019866,
        "status": "PAID",
        "coinGecko": "tether",
        "blockchainNetwork": {
            "name": "BEP-20",
            "chainId": "56"
        }
    },
    "customerId": "68e7b8f*******************"
}
```

### Field Description

| Field                   | Type      | Description                                                                                                                                                         |
| :---------------------- | :-------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `_id`                   | `string`  | Unique transaction ID generated by XGate.                                                                                                                           |
| `currency`              | `object`  | *(Conditional)* Object containing the Fiat financial data of the transaction, such as currency (`name`), method (`type`), amount (`amount`), and status (`status`). |
| `cryptocurrency`        | `object`  | *(Conditional)* Object containing the Crypto data of the transaction, such as currency, amount, status, and blockchain network used (`blockchainNetwork`).          |
| `document`              | `string`  | *(Conditional)* The CPF/CNPJ linked to the origin account that performed the Pix.                                                                                   |
| `externalId`            | `string`  | *(Optional)* The order ID in your system, if sent during creation.                                                                                                  |
| `identifiedDocumentPix` | `boolean` | *(Conditional)* Indicates whether the payer's document was successfully validated by the Pix network.                                                               |
| `customerId`            | `string`  | Customer ID linked to the transaction in XGate.                                                                                                                     |

### Common Errors

| Status  | Message                 | Probable Cause                                                                              |
| :------ | :---------------------- | :------------------------------------------------------------------------------------------ |
| **401** | `Unauthorized`          | • Invalid or expired token.<br /> • Header invalid or not provided.<br /> • IP not allowed. |
| **404** | `Not Found`             | • Provided transaction ID is invalid.<br />• The deposit does not exist in the system.      |
| **500** | `Internal Server Error` | Internal server error. Contact support.                                                     |

---

## How to Use

Although the most efficient way to track deposits is by receiving **Webhooks**, this query route is an indispensable read endpoint for maintaining your system.

### Common Use Cases

You will primarily use this endpoint in the following situations:

1. **Reconciliation and Auditing:** Confirm if the amount (`amount`), network data (`blockchainNetwork`), or payer (`document`) of a deposit received in XGate exactly matches what is in your internal database.
2. **Failure Recovery (Fallback):** If your server goes offline and you miss receiving a Webhook, you can create a routine (CRON) that queries "Pending" deposits using this endpoint to update the lost statuses and release the balance to the user.
3. **Customer Support (CS):** Fetch data of a specific deposit in real-time to help an end customer who sent the money but claims the balance has not arrived on the platform.

### Practical Example

The primary purpose is to verify the transaction progress. When querying the endpoint, you will focus on the `status` field corresponding to the operation to determine what to show your end customer.

**Verifying the payment:**

In the code below, the system validates if the response has the `currency` (Fiat) or `cryptocurrency` (Crypto) object to extract the correct transaction status:

---

## Integration

Below is a simple example of how to implement this query using Node.js.

<Tabs groupId="sdk-examples">
  <TabItem value="js" label="Node.js">
    The integration example uses the `Axios` library to perform the HTTP request.

    **Installing `Axios`:**
    ```bash
    npm install axios
    ```

    **Javascript Example:**
    ```javascript
    const axios = require("axios");

    (async () => {
        const email = "email@domain.com";
        const password = "••••••";
        const transactionId = "6996202*******************";

        try {
            const url_api = "https://api.xgateglobal.com";
            
            // 1. Get authentication token
            const login = await axios.post(`${url_api}/auth/token`, { email, password });
            
            // 2. Consult deposit details
            const { data } = await axios.get(`${url_api}/deposit/${transactionId}/details`, {
                headers: {
                    "Authorization": `Bearer ${login.data.token}`
                }
            });
            
            console.log("Deposit Details:", data);
            
            // Dynamic example of using the response (Fiat or Crypto):
            const operation = data.currency || data.cryptocurrency;
            
            if (operation && operation.status === "PAID") {
                const origin = data.document || "Blockchain";
                console.log(`The deposit was successfully paid by the origin: ${origin}`);
            } else {
                console.log("Transaction status:", operation ? operation.status : "Unknown");
            }

        } catch (error) {
            console.error("Query error:", error.response ? error.response.data : error.message);
        }
    })();
    ```
  </TabItem>
</Tabs>