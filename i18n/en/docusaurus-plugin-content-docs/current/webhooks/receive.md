---
sidebar_label: 'Receive Webhooks'
sidebar_position: 6
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import useBaseUrl from '@docusaurus/useBaseUrl';

# Receiving Webhooks

Webhooks are automatic notifications sent by XGate to your system whenever the status of a transaction changes (e.g. a Pix deposit was paid, a settlement error occurred, or a withdrawal entered processing).

This eliminates the need for your system to poll the API repeatedly to check whether a payment cleared. XGate acts only as a messenger: we send the information, and your system must be prepared to receive and handle it.

---

## Configuring in the Dashboard

It is important to understand that **XGate does not provide a webhook URL**. You (or your development team) must build a public route on your own server to receive the data. After creating that route, register it in the XGate dashboard.

Follow the steps below to configure notifications:

1. Open the **Webhooks** menu in your XGate dashboard.
2. Click **+ Add Integration** or click **Configure** on an empty slot.
3. Fill in the destination fields:
    * **Name:** An internal identifier for you (e.g. "Primary Server Webhook").
    * **URL:** The full address of the endpoint hosted on your server (e.g. `https://your-company.com/api/webhooks/xgate`).

4. **Events:** Select which notifications you want XGate to send to this URL. Events are grouped as:
    * **CRYPTOCURRENCY:** Crypto transactions.
    * **CURRENCY:** Fiat currency transactions (Pix, including approvals, rejections, errors, and the full refund/dispute lifecycle).

:::tip[Integration Tip]
We recommend that you **enable all available events**. This ensures your database mirrors what is happening in XGate, preventing transactions from remaining stuck in outdated statuses. The final choice is yours.
:::

---

## Security: IP Whitelist

To ensure your system is not subject to fake webhook attacks (malicious actors simulating a payment approval), XGate sends all notifications from a **single fixed IP**.

We strongly recommend configuring your server firewall or adding validation in your code to accept only `POST` requests originating from the following IP:

**Official XGate IP:** `107.23.39.46`

---

## Idempotency and "externalId"

When creating Deposit or Withdrawal orders, you can send the `externalId` field. It serves two vital purposes:

1. **Duplicate Prevention (Idempotency):** Prevents network failures or double-clicks from creating multiple identical transactions in XGate. If we receive two requests with the same `externalId`, the second will be ignored.
2. **Traceability:** Acts as your system's unique order code.

**Note:** If you include `externalId` when creating the transaction, XGate will return it inside the webhook payload, making it easier to look up records in your database.

---

## How does the flow work?

1. You register **your URL** in the XGate dashboard and select the events.
2. When one of the selected events occurs, XGate makes a **POST** request to your URL from the IP `107.23.39.46`.
3. Your system receives the JSON, processes business logic, and **acknowledges receipt by returning HTTP 200 OK**.

:::warning[Integration Best Practice]
Your server **MUST** return HTTP status `200` (OK) immediately after receiving the webhook. This is the standard practice to inform XGate that your system processed the notification successfully, properly closing the connection and avoiding communication timeouts between servers.
:::

---

## Request Format and Variations

The payload format varies slightly depending on whether the transaction involves only Fiat (Pix) or Cryptocurrencies (USDT).

- **Method:** <span className="badge badge--info">POST</span>

### Payload Examples

**1. Standard Transaction (Pix BRL):**
Returns the `type` field specifying the method.

```json
{
    "id": "676071f1*************",
    "customerId": "123456*************",
    "status": "PAID",
    "name": "BRL",
    "type": "PIX",
    "amount": 2,
    "operation": "DEPOSIT"
}
```

**2. Withdrawal (USDT converted to Pix):**
The `type` field is omitted for operations involving crypto balances.

```json
{
    "id": "676070dc*************",
    "customerId": "123456*************",
    "status": "PAID",
    "name": "USDT",
    "amount": 0.04,
    "operation": "WITHDRAW"
}
```

**3. Deposit (Pix converted to USDT or direct USDT):**

```json
{
    "id": "676070*************",
    "customerId": "123456*************",
    "status": "PAID",
    "name": "USDT",
    "amount": 0.332,
    "operation": "DEPOSIT"
}
```

### Field Descriptions

| Field        | Type     | Description                                                                          |
| :----------- | :------- | :----------------------------------------------------------------------------------- |
| `id`         | `string` | Unique transaction ID generated by XGate.                                            |
| `status`     | `string` | Current transaction status (see table below).                                        |
| `name`       | `string` | The transaction's base currency (e.g. `BRL`, `USDT`).                                |
| `type`       | `string` | *(Conditional)* The method used (e.g. `PIX`). Usually absent in crypto transactions. |
| `amount`     | `number` | The amount processed in the transaction.                                             |
| `operation`  | `string` | Indicates whether it is an inflow or outflow (`DEPOSIT` or `WITHDRAW`).              |
| `customerId` | `string` | ID of the customer linked to the transaction.                                        |
| `externalId` | `string` | *(Optional)* Your system's order ID, returned only if provided at creation.          |

---

## Possible Statuses

Your system should be prepared to handle both normal transaction statuses and refund/dispute (chargeback) statuses.

### Main Transaction Flow

| Status                                                     | Meaning                                                                       | Recommended Action                                                                |
| :--------------------------------------------------------- | :---------------------------------------------------------------------------- | :-------------------------------------------------------------------------------- |
| <span className="badge badge--secondary">PROCESSING</span> | The transaction is being processed.                                           | Log the progress (common for withdrawals).                                        |
| <span className="badge badge--success">PAID</span>         | Transaction completed and paid successfully.                                  | **Release funds/product or confirm the withdrawal.**                              |
| <span className="badge badge--danger">ERROR</span>         | Operation failed (e.g. incorrect Pix key for withdrawals, invalid ownership). | Notify the end user about the failure and suggest verifying provided information. |
| <span className="badge badge--danger">REJECTED</span>      | Rejected by the settlement partner/bank.                                      | Rare; treat as a definitive failure.                                              |

### Refunds and Disputes (Chargeback) Flow

| Status                                                                   | Meaning                                                                    | Recommended Action                                      |
| :----------------------------------------------------------------------- | :------------------------------------------------------------------------- | :------------------------------------------------------ |
| <span className="badge badge--warning">AWAITING_REFUND_CONTESTION</span> | The end user opened a refund request with their bank. The funds are held.  | Freeze the customer's balance/service preventively.     |
| <span className="badge badge--warning">AWAITING_BANK_VEREDICT</span>     | You submitted the dispute defense and we are awaiting the bank's judgment. | Await resolution.                                       |
| <span className="badge badge--danger">EXPIRED_DISPUTE</span>             | The deadline to submit dispute evidence has expired.                       | Record the dispute loss.                                |
| <span className="badge badge--success">REFUND_CANCELED</span>            | The refund was canceled by the bank (you won the dispute).                 | The held amount is returned to your account.            |
| <span className="badge badge--danger">REFUND_APPROVED</span>             | The refund was approved by the bank (you lost the dispute).                | The amount is returned to the end customer permanently. |
